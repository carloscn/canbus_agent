#include "test_pal_cipher.h"
#include "pal_cipher.h"
#include "utils.h"
#include "CUnit/Basic.h"
#include "hal_err.h"

static const unsigned char __attribute__((aligned(8))) aes_test_cbc_key[16] = {
        0x2B, 0x7E, 0x15, 0x16, 0x28, 0xAE, 0xD2, 0xA6,
        0xAB, 0xF7, 0x15, 0x88, 0x09, 0xCF, 0x4F, 0x3C,
};

static const unsigned char __attribute__((aligned(8))) aes_test_cbc_key_256[32] = {
        0x2B, 0x7E, 0x15, 0x16, 0x28, 0xAE, 0xD2, 0xA6,
        0xAB, 0xF7, 0x15, 0x88, 0x09, 0xCF, 0x4F, 0x3C,
        0x1f, 0x72, 0x86, 0x98, 0x4d, 0xde, 0x8c, 0xef,
        0xfb, 0xd8, 0x54, 0x3c, 0x7b, 0x6c, 0xa5, 0x74,
};

static const unsigned char __attribute__((aligned(8))) aes_test_cbc_iv[16] = {
        0x55, 0x5c, 0x82, 0x24, 0xe2, 0xc9, 0x58, 0x73,
        0x12, 0x08, 0x5b, 0xfb, 0x4e, 0xcb, 0x04, 0xb8,
};

static const unsigned char __attribute__((aligned(8))) aes_test_cbc_dec[256] = {
        0xb0,0x6a,0x73,0x0c,0x8d,0x5a,0x62,0x73,0x91,0x86,0x65,0x0c,0x96,0xfe,0x67,0x34,
        0x50,0x5f,0x0c,0x11,0x4d,0xe7,0xf0,0xdb,0x0d,0xed,0xbd,0xb6,0xd5,0x90,0xf5,0x93,
        0xe1,0xfb,0x76,0x7e,0xc3,0xdf,0x45,0xa0,0x8c,0x18,0xcf,0xee,0x77,0x9d,0xbe,0x72,
        0xdc,0xe8,0xc8,0x4b,0xb3,0x3a,0xec,0xf3,0x4e,0xdc,0xd6,0xc8,0x63,0x11,0xfd,0xd4,
        0x69,0xbc,0x8c,0xfe,0xf4,0x9b,0xad,0x45,0x4d,0x3e,0x63,0x49,0xce,0xe7,0x81,0x7a,
        0x62,0x58,0xcf,0xc7,0x74,0xc2,0x41,0x12,0x61,0x7b,0xb7,0x22,0xd8,0x15,0x1d,0x70,
        0x9f,0x06,0x5c,0x79,0x07,0x38,0xdb,0x16,0xef,0x70,0x3e,0x59,0x7c,0x09,0x40,0x74,
        0x46,0x63,0x8c,0x58,0xe2,0x57,0xff,0x67,0x55,0x56,0x87,0x1a,0x56,0x22,0x5a,0x2f,
        0xb8,0x16,0x91,0xf3,0x04,0x9e,0x47,0xb7,0xef,0x71,0x39,0xd8,0x30,0xec,0x62,0xaa,
        0x0b,0xeb,0x7e,0xba,0xd0,0x76,0x2a,0x6e,0xed,0xa8,0x7f,0x87,0x16,0xa2,0xda,0x9f,
        0xb4,0x70,0xdc,0xa4,0x1f,0xc5,0x20,0x47,0x5f,0x41,0xf0,0x3e,0x6a,0xdc,0xc4,0x75,
        0xcf,0x11,0x88,0x78,0x98,0x3b,0x4e,0x5e,0xc0,0x25,0x0e,0xe6,0xfc,0xeb,0x0a,0xaa,
        0x22,0x9c,0x39,0xca,0x16,0x80,0x38,0x6a,0xcc,0x91,0x81,0x50,0x16,0x99,0x94,0x0d,
        0x32,0x56,0x6b,0x92,0x92,0x5e,0x52,0xb8,0x6e,0x4b,0x79,0x3f,0x79,0x87,0x21,0xdd,
        0x4e,0xa9,0xf2,0x84,0x7a,0xe9,0xf4,0x3d,0x4e,0xc7,0x46,0x6d,0x3d,0x3c,0x88,0x4e,
        0xa0,0x7d,0xda,0xd8,0x06,0x1a,0x35,0xa5,0x42,0x50,0x5a,0xdf,0x5d,0x43,0x36,0x3e
};

static const unsigned char __attribute__((aligned(8))) aes_test_cbc_dec_padding[256 + PAL_CIPHER_AES_CBC_BLOCK_SIZE] = {
        0xb0,0x6a,0x73,0x0c,0x8d,0x5a,0x62,0x73,0x91,0x86,0x65,0x0c,0x96,0xfe,0x67,0x34,
        0x50,0x5f,0x0c,0x11,0x4d,0xe7,0xf0,0xdb,0x0d,0xed,0xbd,0xb6,0xd5,0x90,0xf5,0x93,
        0xe1,0xfb,0x76,0x7e,0xc3,0xdf,0x45,0xa0,0x8c,0x18,0xcf,0xee,0x77,0x9d,0xbe,0x72,
        0xdc,0xe8,0xc8,0x4b,0xb3,0x3a,0xec,0xf3,0x4e,0xdc,0xd6,0xc8,0x63,0x11,0xfd,0xd4,
        0x69,0xbc,0x8c,0xfe,0xf4,0x9b,0xad,0x45,0x4d,0x3e,0x63,0x49,0xce,0xe7,0x81,0x7a,
        0x62,0x58,0xcf,0xc7,0x74,0xc2,0x41,0x12,0x61,0x7b,0xb7,0x22,0xd8,0x15,0x1d,0x70,
        0x9f,0x06,0x5c,0x79,0x07,0x38,0xdb,0x16,0xef,0x70,0x3e,0x59,0x7c,0x09,0x40,0x74,
        0x46,0x63,0x8c,0x58,0xe2,0x57,0xff,0x67,0x55,0x56,0x87,0x1a,0x56,0x22,0x5a,0x2f,
        0xb8,0x16,0x91,0xf3,0x04,0x9e,0x47,0xb7,0xef,0x71,0x39,0xd8,0x30,0xec,0x62,0xaa,
        0x0b,0xeb,0x7e,0xba,0xd0,0x76,0x2a,0x6e,0xed,0xa8,0x7f,0x87,0x16,0xa2,0xda,0x9f,
        0xb4,0x70,0xdc,0xa4,0x1f,0xc5,0x20,0x47,0x5f,0x41,0xf0,0x3e,0x6a,0xdc,0xc4,0x75,
        0xcf,0x11,0x88,0x78,0x98,0x3b,0x4e,0x5e,0xc0,0x25,0x0e,0xe6,0xfc,0xeb,0x0a,0xaa,
        0x22,0x9c,0x39,0xca,0x16,0x80,0x38,0x6a,0xcc,0x91,0x81,0x50,0x16,0x99,0x94,0x0d,
        0x32,0x56,0x6b,0x92,0x92,0x5e,0x52,0xb8,0x6e,0x4b,0x79,0x3f,0x79,0x87,0x21,0xdd,
        0x4e,0xa9,0xf2,0x84,0x7a,0xe9,0xf4,0x3d,0x4e,0xc7,0x46,0x6d,0x3d,0x3c,0x88,0x4e,
        0xa0,0x7d,0xda,0xd8,0x06,0x1a,0x35,0xa5,0x42,0x50,0x5a,0xdf,0x5d,0x43,0x36,0x3e,
        0x13,0x9e,0x26,0xaf,0xc5,0x72,0x44,0xbc,0x6d,0x78,0x50,0x66,0x2f,0x66,0x8f,0x8e,
};

static const unsigned char __attribute__((aligned(8))) aes_test_cbc_enc[256] = {
        0x13,0x9e,0x26,0xaf,0xc5,0x72,0x44,0xbc,0x6d,0x78,0x50,0x66,0x2f,0x66,0x8f,0x8e,
        0x4f,0xa0,0x34,0x03,0x7c,0x72,0x20,0x46,0x12,0xbd,0x7b,0x74,0xbe,0xf7,0x38,0x11,
        0x9d,0xe6,0x03,0x8b,0x4f,0xcc,0x42,0x16,0xa7,0xd0,0x8d,0x9b,0x7d,0x9e,0x10,0x36,
        0x9d,0x38,0x35,0x76,0x31,0xa3,0x23,0x54,0x74,0x1e,0xc1,0x16,0xd3,0x18,0x59,0xfb,
        0xdf,0x2a,0x7b,0xe4,0x2b,0x0d,0xd3,0xa0,0xb2,0x0f,0x9a,0xe9,0x7e,0xc8,0x0e,0x1e,
        0x13,0xea,0x6a,0x20,0xb9,0x0f,0x68,0x06,0xe4,0xb7,0xad,0x7d,0xca,0xb1,0x83,0x10,
        0xa2,0x9e,0x9f,0xd8,0x39,0x47,0x8f,0x7a,0x8f,0x70,0x57,0xbd,0x90,0xef,0xec,0x5f,
        0xb4,0x1e,0x62,0xe8,0xd6,0x35,0xc5,0x87,0x52,0x27,0x94,0xcd,0xe4,0x53,0xeb,0xb5,
        0xa2,0xd9,0x28,0x61,0x34,0x43,0xab,0x5a,0xd9,0xc9,0x38,0x50,0xba,0x35,0x0c,0x4c,
        0x8c,0xd7,0xc7,0xaa,0x79,0x2f,0x0d,0x00,0x27,0x90,0x08,0x04,0x50,0xbe,0xd8,0x7b,
        0x92,0x08,0x9b,0xb7,0x6d,0xe1,0xc2,0x2e,0x13,0xce,0xbd,0xa3,0xd5,0x22,0x46,0xb9,
        0x27,0xee,0x57,0x28,0xe8,0x7a,0x27,0x2f,0x3c,0x2e,0xbe,0xd0,0xfa,0xd1,0xad,0x91,
        0xb4,0xb4,0x2c,0x43,0xce,0x45,0xc0,0xdb,0x73,0x44,0x65,0x57,0xb4,0x4c,0xda,0x4a,
        0xbb,0xc6,0x25,0x8c,0x5f,0x7a,0x24,0xd5,0xac,0xc4,0xc3,0x0a,0xcb,0x7d,0x7e,0x48,
        0x04,0x40,0xba,0x33,0x79,0xca,0x50,0x1d,0x4f,0xf5,0xbd,0x8e,0x4b,0xee,0xef,0xe6,
        0xcd,0x00,0xe7,0x3f,0xd9,0x65,0xd0,0xcc,0x60,0x27,0x80,0x7b,0xe3,0x7e,0x07,0x85
};

static const unsigned char __attribute__((aligned(8))) aes_test_cbc_dec_256[256] = {
        0xec,0x85,0x23,0x01,0xd0,0x24,0x5c,0x0e,0x42,0x84,0xd3,0x8e,0x03,0x32,0xa3,0x45,
        0x24,0x33,0xe1,0x50,0x77,0x72,0x3b,0x38,0xb3,0xc8,0x16,0x23,0x57,0xc5,0xf4,0x1a,
        0x78,0x21,0xf7,0xcd,0xad,0x77,0x43,0x4d,0x13,0x50,0xa4,0x4c,0xee,0x77,0x30,0x6c,
        0x67,0x90,0x57,0x64,0x79,0xf5,0x56,0x48,0xb2,0x7c,0x40,0x29,0x2a,0x44,0x5f,0xb8,
        0x1b,0x20,0x60,0x87,0x8e,0xae,0xd0,0x7e,0x2f,0x5f,0x08,0xcb,0xe8,0xff,0xa4,0x52,
        0xb9,0xa1,0x11,0x11,0x8a,0x2b,0xbc,0xdd,0x42,0xa2,0xde,0xa0,0xd5,0x0e,0x1f,0xba,
        0xa4,0xe6,0x97,0x71,0x6c,0x5b,0x97,0xe7,0x91,0x1a,0xfe,0x04,0x6c,0x2e,0x08,0xb0,
        0x3b,0x90,0x03,0x4f,0x86,0x58,0xd7,0xd1,0xd1,0x5e,0xbe,0xef,0xc0,0x9a,0x54,0x5e,
        0xef,0x0f,0x6a,0x2d,0xac,0x4a,0x39,0xc7,0xdb,0xce,0x54,0xe4,0x35,0xaf,0xc9,0xeb,
        0x70,0x2d,0x30,0xa2,0x03,0xc3,0xc3,0x56,0xa9,0xda,0x46,0x7a,0xad,0x27,0x09,0xf9,
        0x24,0xc2,0x41,0xdb,0x9e,0xd1,0x5d,0x84,0x90,0xe3,0x09,0xdc,0x6d,0xa3,0xfd,0x65,
        0xcb,0xb2,0x93,0x28,0x91,0x5c,0x01,0xa4,0x04,0xa3,0xfd,0x55,0x7c,0x83,0x07,0x6f,
        0x3f,0xc9,0x3d,0xe4,0xc4,0x6a,0xca,0x5a,0xd8,0x62,0xd7,0x23,0x84,0xcb,0xae,0x4d,
        0xb9,0x17,0x76,0x73,0xfa,0x9e,0xc8,0x50,0xd3,0x3e,0x50,0xcd,0xdf,0x98,0x04,0x30,
        0x0a,0x3e,0xc7,0x66,0x8e,0x2f,0x63,0xe8,0x4b,0xb3,0x8c,0x10,0x1e,0x4a,0xba,0xd4,
        0x78,0xfd,0xa8,0x6f,0xb8,0x70,0xa8,0x90,0x7a,0x99,0x53,0x86,0xdd,0x7e,0xc8,0x37,
};

static uint8_t const __attribute__((aligned(8))) test_buf1[] =
{
    0xf7, 0x80, 0x8c, 0xf0, 0x64, 0x61, 0x44, 0x21, 0x41, 0x2a, 0x6c, 0x3f, 0x91, 0x9d, 0x0d, 0x03,
    0x3f, 0xee, 0xf3, 0xc7, 0x72, 0x52, 0xd4, 0xa7, 0x89, 0x68, 0xb8, 0xd6, 0x5f, 0xd0, 0x24, 0x3a,
    0x65, 0xa9, 0x6d, 0x7a, 0x35, 0x7e, 0xa1, 0xb2, 0x72, 0xda, 0xee, 0x58, 0x2f, 0xb9, 0x72, 0x9d,
};

static uint8_t const __attribute__((aligned(8))) test_buf2[] =
{
    0x14, 0x96, 0xf5, 0x15, 0x2f, 0x82, 0xdf, 0x9c, 0x0b, 0xd1, 0x4f, 0xee, 0xeb, 0x76, 0x16, 0x80,
    0x5a, 0x12, 0x7b, 0xe2, 0x80, 0x8d, 0xce, 0x3d, 0xf9, 0xa2, 0xfb, 0xcc, 0xb8, 0xc3, 0x29, 0xe9,
    0x8f, 0xee, 0xb5, 0xad, 0xf2, 0xfb, 0x53, 0x16, 0x9e, 0xb5, 0xd8, 0x2d, 0x45, 0x70, 0x8d, 0xb0,
    0x2c, 0xe4, 0x8c, 0x39, 0xdb, 0x89, 0xb7, 0x83, 0x7f, 0x68, 0xcb, 0x24, 0xfa, 0x69, 0x77, 0x34,
    0x85, 0xc3, 0x2a, 0xc4, 0xbf, 0xb0, 0x24, 0x28, 0x1a, 0x16, 0xca, 0x71, 0x9d, 0x51, 0x0a, 0x85,
    0x51, 0xdf, 0x93, 0xce, 0x51, 0x70, 0xa5, 0x24, 0xea, 0x98, 0x8a, 0x34, 0x51, 0xdc, 0xef, 0xc4,
    0xe8, 0xb8, 0xdf, 0x0b, 0x26, 0x78, 0xd0, 0xe9, 0xcb, 0x4b, 0xb2, 0x9c, 0xff, 0xed, 0x90, 0x26,
    0x3d, 0xa6, 0x0c, 0x32, 0xe3, 0x30, 0x1b, 0xc3, 0x72, 0x00, 0x2f, 0xe9, 0xb4, 0x93, 0x0d, 0xd0,
    0xc2, 0x69, 0xe0, 0x2b, 0xb5, 0xd6, 0x52, 0x15, 0x27, 0xe8, 0x42, 0xbd, 0x2f, 0xc1, 0xc6, 0xd7,
    0x38, 0xff, 0x5e, 0x8a, 0x5c, 0xa4, 0xb4, 0x42, 0x2d, 0xfa, 0xba, 0x08, 0x92, 0x03, 0x56, 0x65,
    0x03, 0xbf, 0x23, 0x6a, 0x81, 0xa9, 0x62, 0x21, 0x9f, 0x6f, 0x84, 0x67, 0x75, 0xd8, 0x18, 0xd6,
    0x72, 0x2f, 0x47, 0xf4, 0xe5, 0x23, 0x77, 0xd9, 0xc0, 0x33, 0x28, 0x25, 0x94, 0xed, 0xa5, 0x6f,
    0xa5, 0x45, 0xe8, 0xc9, 0x2b, 0x83, 0x1d, 0x86, 0x21, 0x7f, 0xc0, 0x7b, 0xc8, 0x1f, 0x6e, 0x73,
    0xa0, 0xc4, 0xe8, 0xd7, 0x4d, 0xc3, 0x32, 0x92, 0xd7, 0xe1, 0x6a, 0xb0, 0x60, 0x85, 0x12, 0xb6,
    0x50, 0x41, 0xa4, 0x01, 0x8e, 0x71, 0xb3, 0x6d, 0xf9, 0xb0, 0x3e, 0x8a, 0xea, 0x2e, 0xf2, 0xfe,
    0xa1, 0x93, 0xab, 0x81, 0xc0, 0xad, 0x36, 0x2c, 0xfc, 0x63, 0x45, 0x20, 0x12, 0x5f, 0xe0, 0xcc,
    0x46, 0xa4, 0x6f, 0xe8, 0x46, 0xc7, 0xd1, 0xd2, 0x88, 0x61, 0x90, 0x4e, 0xaa, 0x2b, 0x00, 0xe9,
    0xef, 0xbf, 0x82, 0xe3, 0x8d, 0x36, 0x4e, 0x84, 0xb1, 0x0e, 0x94, 0xac, 0x1f, 0xa7, 0x72, 0xfa,
    0xf1, 0x37, 0xee, 0x87, 0xa5, 0x74, 0x86, 0x0b, 0x1d, 0xe1, 0xa8, 0x72, 0xdd, 0xb0, 0x01, 0xc4,
    0xd9, 0xe7, 0x93, 0x8f, 0xc8, 0x57, 0x40, 0x23, 0xab, 0x28, 0x59, 0x20, 0x69, 0xfc, 0x78, 0x21,
    0x7c, 0x53, 0x59, 0xa6, 0x27, 0xdd, 0xd2, 0xcf, 0x9c, 0x63, 0x4c, 0xc5, 0xfd, 0xea, 0x53, 0x07,
    0xae, 0xe7, 0x66, 0x5f, 0x01, 0xaa, 0x15, 0x2f, 0x4a, 0x45, 0x6d, 0x94, 0xc6, 0x9a, 0xfd, 0x1a,
    0x90, 0xa8, 0x8c, 0x86, 0xe0, 0xf0, 0x83, 0x78, 0x3e, 0x89, 0xf1, 0xa3, 0xa2, 0x0d, 0x1f, 0xdd,
    0x6e, 0x65, 0x42, 0x89, 0x89, 0x6d, 0x68, 0xce, 0xa7, 0xfb, 0xfa, 0xa1, 0x41, 0x73, 0x8e, 0x66,
    0x71, 0x1a, 0x15, 0x46, 0xc7, 0xd7, 0x42, 0x95, 0x8c, 0x0e, 0x03, 0xbd, 0xae, 0x56, 0xb5, 0x6c,
    0xf3, 0xd8, 0x65, 0xe3, 0xe0, 0xed, 0x05, 0x64, 0x44, 0xdc, 0xf3, 0xe4, 0xac, 0xc6, 0x13, 0x17,
    0x2b, 0x91, 0x0b, 0x3b, 0x96, 0xae, 0x2b, 0x38, 0xa6, 0x17, 0xd5, 0x43, 0xed, 0x8c, 0xfe, 0x09,
    0x40, 0xc7, 0xf9, 0x7e, 0x71, 0x71, 0x42, 0x5e, 0xaa, 0x1d, 0x8d, 0x16, 0xc3, 0xd1, 0x32, 0x79,
    0x34, 0xed, 0x3a, 0xbf, 0x64, 0x8b, 0x1e, 0x67, 0xb8, 0x1c, 0xfd, 0x06, 0x5d, 0xb7, 0xc7, 0xc0,
    0x3f, 0xf3, 0x34, 0xf0, 0x6e, 0x52, 0xbb, 0x51, 0xc1, 0xb3, 0xef, 0x62, 0x5d, 0x43, 0xcf, 0x3d,
    0xf7, 0xbf, 0xc3, 0x00, 0x45, 0x95, 0x2f, 0x99, 0xf4, 0x16, 0x74, 0x1e, 0x0b, 0x06, 0xaf, 0x69,
    0x3c, 0xb0, 0x27, 0x4f, 0x50, 0x58, 0x34, 0x6a, 0xb8, 0x97, 0x44, 0x1e, 0x9a, 0x96, 0x53, 0x37,
    0xaf, 0x43, 0x34, 0x2d, 0x76, 0x86, 0x07, 0x86, 0xd2, 0x96, 0x96, 0xbb, 0x5c, 0xb8, 0x5a, 0x2c,
    0x1a, 0xa0, 0xe5, 0x72, 0x13, 0x6e, 0xf4, 0xee, 0xed, 0x5e, 0x9d, 0xad, 0x6b, 0xc4, 0xbe, 0x1b,
    0x76, 0x1a, 0x89, 0x37, 0x57, 0x5b, 0x99, 0x53, 0xa6, 0x10, 0xc9, 0x15, 0xcd, 0x4c, 0xe0, 0x73,
    0xb7, 0x92, 0xfe, 0x6c, 0xca, 0xc7, 0x9b, 0x15, 0xa3, 0x17, 0x9f, 0x3e, 0x5e, 0xbc, 0x65, 0x21,
    0x5c, 0x94, 0x10, 0x03, 0x65, 0x31, 0xb4, 0x13, 0x68, 0x15, 0xa2, 0x00, 0x91, 0x2f, 0x1c, 0x2f,
    0xe1, 0x9b, 0x0a, 0x36, 0x0d, 0x83, 0x15, 0xb5, 0x28, 0x9e, 0xe3, 0x8b, 0xca, 0x4e, 0xde, 0x81,
    0x1f, 0xec, 0xeb, 0x27, 0xf3, 0x0f, 0x19, 0x91, 0x1f, 0x7b, 0x92, 0x22, 0xe0, 0xcb, 0xa7, 0x0e,
    0x39, 0x55, 0x4f, 0x69, 0x99, 0x8e, 0x56, 0x74, 0x14, 0xff, 0x87, 0xfa, 0x42, 0x53, 0x51, 0xe6,
    0xf4, 0x57, 0x62, 0x67, 0xe9, 0x78, 0x6a, 0x1b, 0x68, 0xce, 0x81, 0xca, 0xdb, 0xba, 0xf6, 0xad,
    0x5a, 0x3e, 0x17, 0xc5, 0x83, 0xa0, 0xb7, 0x57, 0x80, 0xaa, 0x0d, 0x31, 0x44, 0x6f, 0xe9, 0xa5,
    0x96, 0x89, 0x86, 0x18, 0x65, 0xc7, 0xfa, 0x40, 0xf0, 0x3b, 0xe9, 0x5b, 0xb6, 0x27, 0x18, 0x0e,
    0x39, 0x74, 0x24, 0x7d, 0xff, 0xc5, 0x36, 0x0f, 0xc5, 0xfc, 0x1c, 0x48, 0xce, 0x8f, 0x89, 0x8b,
    0x24, 0xbd, 0x99, 0xe5, 0x4e, 0x08, 0x69, 0x8e, 0x36, 0xb3, 0xdd, 0xb6, 0x7a, 0xe6, 0xfb, 0xf1,
    0x90, 0xcc, 0xec, 0xd6, 0x5e, 0x93, 0x56, 0x63, 0xa4, 0x02, 0x34, 0x24, 0x62, 0x21, 0x21, 0xa6,
    0xca, 0x48, 0xa4, 0x4c, 0x7d, 0x9d, 0xc3, 0x64, 0x89, 0x38, 0x20, 0x29, 0xd9, 0x52, 0x0d, 0x07,
    0x98, 0x7a, 0x62, 0x33, 0x9f, 0x31, 0xad, 0x4f, 0xce, 0x09, 0xdd, 0x6f, 0xcf, 0x8c, 0x03, 0x8a,
    0x60, 0x23, 0x06, 0xc0, 0x8d, 0x1c, 0xa8, 0x71, 0x7c, 0x9b, 0x07, 0x4e, 0x26, 0x94, 0xe0, 0x5b,
    0x78, 0x22, 0x66, 0x5e, 0xda, 0x1d, 0xe9, 0xe0, 0xe6, 0xb7, 0x0a, 0xee, 0x69, 0xe0, 0x94, 0xce,
    0x41, 0x2c, 0x48, 0x54, 0x5e, 0x13, 0x70, 0xdc, 0x84, 0xda, 0x5f, 0x34, 0xf2, 0x78, 0x05, 0xc4,
    0x8d, 0x31, 0x3c, 0xa1, 0xe3, 0x8e, 0x22, 0x62, 0xce, 0x31, 0x4b, 0xe7, 0xb2, 0xa7, 0xae, 0x23,
    0x22, 0x87, 0x37, 0xb2, 0x0f, 0x52, 0xdf, 0x7f, 0xf6, 0x20, 0x81, 0x01, 0xf6, 0xcc, 0x2b, 0x9b,
    0x05, 0x22, 0x66, 0xf1, 0xd8, 0x85, 0xf6, 0x71, 0x12, 0x81, 0x20, 0xf9, 0x21, 0x16, 0x84, 0x4f,
    0x65, 0x8b, 0xb8, 0x3b, 0x55, 0xa1, 0xb7, 0xaf, 0x4f, 0xcf, 0x3d, 0x4c, 0xd4, 0xfc, 0x12, 0x38,
    0xa7, 0x1f, 0x9d, 0x71, 0xdc, 0x42, 0x12, 0x3e, 0x2e, 0x5f, 0x12, 0xcc, 0xad, 0x9b, 0xb0, 0xa2,
    0xdf, 0x57, 0xc9, 0xe6, 0x44, 0xd9, 0x21, 0x8e, 0xb1, 0xa9, 0xbc, 0x5a, 0x2d, 0xfa, 0xb6, 0x0a,
    0xfe, 0x81, 0x77, 0x4a, 0xf4, 0x9f, 0xb9, 0x17, 0x00, 0xd9, 0xe6, 0x0e, 0xf3, 0xc7, 0xfb, 0x38,
    0xe8, 0xbf, 0x47, 0x00, 0x94, 0xf8, 0x7e, 0x3c, 0x9e, 0xeb, 0xac, 0x17, 0x91, 0xa2, 0x90, 0x21,
    0x09, 0xd8, 0x40, 0x91, 0xf1, 0xe3, 0xeb, 0xb2, 0x7a, 0x58, 0xb3, 0x39, 0x1b, 0x87, 0xb0, 0x7c,
    0xc8, 0xd7, 0x47, 0xc7, 0x95, 0xd8, 0xb5, 0x58, 0xca, 0x35, 0x48, 0x6b, 0xc2, 0xbb, 0xcd, 0xcc,
    0xa7, 0xb1, 0xac, 0x3f, 0x76, 0x79, 0x55, 0xd3, 0x9f, 0xbb, 0x12, 0xa0, 0xe9, 0x40, 0xc4, 0xa0,
    0x5c, 0x9d, 0x24, 0xcc, 0x97, 0xbb, 0x89, 0x42, 0xeb, 0xbf, 0x90, 0x65, 0x00, 0x7a, 0x37, 0x67,
    0x43, 0x8d, 0x84, 0xf7, 0xc1, 0xfd, 0x31, 0xfe, 0xf6, 0xfe, 0xe7, 0x38, 0x01, 0x2d, 0xe0, 0x64,
};

static uint8_t const __attribute__((aligned(8))) test_buf3[] =
{
    0x50, 0x4b, 0x03, 0x04, 0x14, 0x00, 0x00, 0x00, 0x08, 0x00, 0x33, 0x58, 0x4e, 0x56, 0x26, 0x0a,
    0x1e, 0x8b, 0xd2, 0x04, 0x00, 0x00, 0x92, 0x06, 0x00, 0x00, 0x0f, 0x00, 0x1c, 0x00, 0x67, 0x6f,
    0x6f, 0x67, 0x6c, 0x65, 0x2e, 0x63, 0x65, 0x72, 0x74, 0x2e, 0x70, 0x65, 0x6d, 0x55, 0x54, 0x09,
    0x00, 0x03, 0x91, 0xf9, 0xea, 0x63, 0xad, 0xf9, 0xea, 0x63, 0x75, 0x78, 0x0b, 0x00, 0x01, 0x04,
    0x02, 0x45, 0xa5, 0x36, 0x04, 0x02, 0x45, 0xa5, 0x36, 0x6d, 0x55, 0xcb, 0xae, 0xab, 0xb8, 0x12,
    0x9d, 0x47, 0xca, 0x3f, 0xf4, 0x3c, 0x3a, 0xe2, 0xb1, 0x43, 0x12, 0x06, 0x3d, 0xb0, 0x8d, 0x79,
    0x24, 0x18, 0x30, 0x21, 0x10, 0x98, 0xf1, 0x26, 0x10, 0x20, 0x6f, 0x03, 0x5f, 0x7f, 0xd9, 0x67,
    0xf7, 0xd5, 0x3d, 0xba, 0x6a, 0x4b, 0x96, 0xec, 0xb2, 0xbd, 0xaa, 0x6a, 0x79, 0x95, 0xfd, 0xeb,
    0xd7, 0xdc, 0x20, 0xd6, 0x0c, 0xeb, 0x2f, 0x84, 0x5d, 0xcf, 0x50, 0x0d, 0x04, 0x3c, 0xfc, 0x6d,
    0xfc, 0xb5, 0x5c, 0x10, 0xc3, 0xc0, 0xad, 0x82, 0x10, 0x58, 0xa3, 0x12, 0x30, 0x03, 0x82, 0xd2,
    0x70, 0x81, 0x69, 0x53, 0xfb, 0x56, 0xf7, 0xef, 0x88, 0x2b, 0xf1, 0xc7, 0x6b, 0xf6, 0x56, 0xb4,
    0xbb, 0xbd, 0x4b, 0xa6, 0xd0, 0x70, 0x7f, 0xe8, 0x23, 0xa3, 0xfa, 0xa4, 0x16, 0xa0, 0xd8, 0x84,
    0x14, 0xb0, 0xe5, 0xc2, 0xad, 0xb1, 0x49, 0x40, 0xa3, 0x01, 0xe1, 0x84, 0x61, 0x45, 0x90, 0xef,
    0x93, 0xc1, 0xa8, 0x41, 0x09, 0x4b, 0xcb, 0x87, 0xa0, 0xf7, 0xb4, 0x53, 0xf6, 0x49, 0xc4, 0xec,
    0x19, 0x1d, 0xe1, 0x29, 0xed, 0xfc, 0x29, 0x43, 0xd0, 0x8b, 0xce, 0x7b, 0x31, 0x0e, 0xac, 0x6b,
    0x3a, 0x42, 0xb2, 0x5c, 0x78, 0x98, 0x0c, 0x78, 0x02, 0xee, 0xcf, 0x09, 0xe2, 0xa1, 0x26, 0x3b,
    0x9d, 0x46, 0xa8, 0xd0, 0x23, 0x18, 0xe8, 0x44, 0x98, 0x5e, 0xa5, 0x16, 0xa9, 0x09, 0x23, 0x1e,
    0x19, 0x88, 0x07, 0x46, 0x52, 0x9f, 0xc6, 0xe0, 0x1f, 0x9b, 0xa5, 0x18, 0xc2, 0x9c, 0xc5, 0x8f,
    0x75, 0x08, 0x6a, 0x10, 0x13, 0xb7, 0x64, 0x6a, 0x19, 0x2a, 0x3e, 0xa5, 0x8a, 0x02, 0x76, 0x77,
    0xb3, 0xfd, 0xaf, 0x7f, 0xa9, 0x4e, 0x44, 0xfe, 0x1d, 0x6b, 0x4f, 0x16, 0x78, 0xc0, 0x83, 0x65,
    0x7a, 0xaf, 0x9a, 0xda, 0x76, 0xa8, 0x01, 0x97, 0x0b, 0x58, 0x96, 0xff, 0xcc, 0x08, 0x84, 0xcc,
    0x42, 0x00, 0xb8, 0x63, 0x9f, 0x8a, 0x11, 0x8d, 0x6f, 0xde, 0x38, 0xe4, 0xd5, 0xf6, 0x15, 0xbc,
    0x5a, 0xb1, 0x0a, 0x0a, 0x47, 0x01, 0x88, 0x5b, 0x9f, 0x56, 0x41, 0xe8, 0x72, 0x5b, 0x1f, 0xd4,
    0x5f, 0x63, 0x5d, 0xbc, 0xa2, 0x70, 0xb9, 0x68, 0xdb, 0xea, 0x5e, 0x6b, 0xea, 0x3e, 0x48, 0x3b,
    0xa1, 0xce, 0x84, 0xa0, 0x14, 0xc8, 0xdd, 0x6a, 0x5f, 0xbc, 0x5e, 0x81, 0xe8, 0x31, 0xf4, 0x0e,
    0x52, 0x5a, 0xbc, 0x72, 0x9e, 0x69, 0xbf, 0x36, 0x50, 0x56, 0xcf, 0x8c, 0x77, 0x06, 0x53, 0xbe,
    0xe3, 0x74, 0x79, 0x07, 0x50, 0x9d, 0x9b, 0x63, 0x00, 0x54, 0x01, 0x65, 0x0e, 0x08, 0x24, 0xdf,
    0x6c, 0x66, 0x7b, 0x4a, 0x09, 0x01, 0xbd, 0x86, 0xd0, 0x53, 0x03, 0xf4, 0xa4, 0x42, 0x36, 0xaf,
    0x00, 0xf6, 0x7b, 0x0d, 0x33, 0x0c, 0x39, 0x46, 0x11, 0x01, 0x80, 0xe9, 0xf4, 0x37, 0x8a, 0x3d,
    0x23, 0xc0, 0x10, 0xab, 0x76, 0x09, 0xb7, 0xe0, 0xeb, 0xcc, 0x9d, 0xd7, 0x94, 0x47, 0x7d, 0x70,
    0xb4, 0x2f, 0x40, 0xf9, 0xaa, 0x1d, 0x6c, 0x0d, 0x05, 0x81, 0xbb, 0xdf, 0xa7, 0x0d, 0x46, 0x43,
    0x02, 0x63, 0xa0, 0x1a, 0x37, 0xbe, 0xd8, 0xac, 0xd4, 0x29, 0xdf, 0xf8, 0x93, 0x27, 0xa6, 0xcb,
    0x05, 0x6f, 0xef, 0x35, 0xd5, 0xb1, 0x06, 0xcb, 0xe5, 0x3b, 0xa2, 0xfd, 0xe9, 0x1b, 0x43, 0xa8,
    0xae, 0xd9, 0x59, 0x01, 0xdd, 0xcc, 0xd5, 0x03, 0x96, 0x58, 0x85, 0x34, 0x65, 0x20, 0x0c, 0x93,
    0x58, 0x77, 0xf9, 0x54, 0xe9, 0x3f, 0xa6, 0x28, 0xd7, 0xcb, 0x45, 0xfa, 0x05, 0xde, 0xa9, 0xf6,
    0xba, 0xfd, 0xf0, 0x9e, 0x7e, 0xa2, 0x2f, 0x77, 0x22, 0x01, 0x99, 0x88, 0x82, 0xff, 0x87, 0x36,
    0x01, 0x54, 0x5d, 0xfc, 0x3e, 0xd3, 0x5d, 0x66, 0x5f, 0x76, 0x9f, 0x3f, 0xf7, 0xcf, 0x08, 0xad,
    0xcf, 0x92, 0x51, 0xae, 0x67, 0x95, 0xf0, 0xe9, 0x28, 0x77, 0x99, 0x4e, 0x86, 0x70, 0x22, 0xef,
    0x48, 0xf3, 0x47, 0x82, 0x9a, 0x9f, 0xfc, 0x29, 0xbd, 0x10, 0x84, 0x90, 0x32, 0xce, 0x32, 0x15,
    0xe5, 0x4f, 0x24, 0x0e, 0x57, 0xb3, 0xb5, 0x3e, 0xc9, 0x51, 0xea, 0x97, 0x8b, 0x78, 0x6d, 0x58,
    0xff, 0x6f, 0x8d, 0x27, 0x50, 0x7d, 0x2b, 0x4c, 0x3f, 0x02, 0xac, 0xd5, 0x20, 0x24, 0xa0, 0xd4,
    0x60, 0x9b, 0x43, 0x05, 0xe0, 0xb9, 0x1e, 0x66, 0xd2, 0xcb, 0xfe, 0x3b, 0x2b, 0x0c, 0xb2, 0x48,
    0x5a, 0x2e, 0x40, 0x79, 0x52, 0x88, 0xf2, 0xc3, 0xb5, 0xce, 0xa8, 0x40, 0x94, 0x59, 0x7f, 0x31,
    0xf8, 0xf4, 0x48, 0xd4, 0x0e, 0x62, 0xc5, 0x67, 0x3a, 0xd8, 0x98, 0x73, 0x8c, 0x69, 0x3b, 0x4c,
    0x66, 0x07, 0x1f, 0xf1, 0x51, 0xea, 0x12, 0x51, 0xee, 0x4c, 0x31, 0xe3, 0xd3, 0x49, 0x9d, 0x79,
    0x20, 0xa3, 0xbc, 0x89, 0xb0, 0x7a, 0xca, 0x14, 0xa8, 0xe6, 0xaa, 0xac, 0xc5, 0xa3, 0x34, 0xef,
    0x66, 0xac, 0x2c, 0xb1, 0xf2, 0xa7, 0x2f, 0x50, 0x52, 0x04, 0x0d, 0x9d, 0x9f, 0xfb, 0x00, 0xec,
    0x1d, 0xc8, 0x28, 0xdc, 0x90, 0x7e, 0x38, 0x2d, 0x17, 0xa2, 0x99, 0xbe, 0x5e, 0x17, 0xe5, 0x6e,
    0xdb, 0xf0, 0xa8, 0xbf, 0x5b, 0xac, 0x76, 0x60, 0xc4, 0x6b, 0xdf, 0xb2, 0x65, 0xe3, 0xc1, 0xbc,
    0xdb, 0xb9, 0x17, 0xcc, 0xc7, 0xa9, 0x04, 0x60, 0xbe, 0x03, 0xbd, 0x21, 0xf4, 0x3a, 0x8f, 0x30,
    0x60, 0x50, 0x23, 0x98, 0x22, 0x43, 0x51, 0x67, 0x4d, 0xbe, 0xfd, 0xb8, 0xa1, 0x1b, 0x4b, 0xde,
    0x8f, 0x07, 0xbb, 0xcd, 0xcf, 0xe2, 0x90, 0xb4, 0xca, 0xe3, 0x98, 0x3b, 0x79, 0x09, 0xb6, 0x82,
    0x05, 0xae, 0x97, 0x80, 0x3a, 0x97, 0xb0, 0xd7, 0xc1, 0x05, 0x32, 0xc1, 0xe9, 0x87, 0x27, 0x37,
    0x74, 0x45, 0xa5, 0xe2, 0x27, 0xf7, 0xca, 0x11, 0x9a, 0xc4, 0xe5, 0x22, 0xf4, 0x4a, 0x12, 0x4c,
    0xf5, 0xdb, 0x3b, 0xad, 0xef, 0x9e, 0x76, 0x3e, 0xf0, 0x82, 0x26, 0x8d, 0x14, 0x8a, 0xc0, 0x2e,
    0x57, 0xbc, 0xd5, 0xaf, 0x64, 0x1a, 0x0a, 0xe4, 0x9d, 0x9d, 0x0f, 0xe6, 0xb8, 0x8f, 0x77, 0x8d,
    0xc2, 0xef, 0x3e, 0x2e, 0x0e, 0x3e, 0xcf, 0x8d, 0xd8, 0x55, 0xd9, 0x97, 0xf0, 0x9a, 0x35, 0xf9,
    0x10, 0xde, 0x73, 0x64, 0xb0, 0x2a, 0x73, 0xca, 0xb8, 0x70, 0x1e, 0xce, 0x2a, 0xc7, 0x29, 0x73,
    0xa9, 0x51, 0x7a, 0xf1, 0xf9, 0xda, 0x6f, 0x5d, 0xbb, 0x30, 0x43, 0x27, 0x38, 0xf0, 0xf5, 0x0a,
    0xcb, 0x59, 0xf3, 0x94, 0x89, 0xf3, 0x54, 0x07, 0x9f, 0x24, 0x61, 0xba, 0x92, 0x36, 0x33, 0xc2,
    0x1b, 0xca, 0xfc, 0x09, 0x20, 0x83, 0x22, 0x4b, 0x8a, 0xd8, 0x6d, 0x67, 0xf9, 0xa8, 0x90, 0x0b,
    0x78, 0x38, 0x6e, 0x92, 0xae, 0xc6, 0x56, 0xf6, 0xae, 0xc9, 0x41, 0x38, 0x16, 0x5c, 0x56, 0x7c,
    0xb2, 0xb0, 0x86, 0xab, 0x52, 0x82, 0xb2, 0x02, 0x2c, 0x58, 0x36, 0x73, 0x4d, 0x5f, 0xb4, 0xe5,
    0x42, 0x66, 0xfc, 0x5c, 0x5c, 0x4f, 0x15, 0x00, 0x1b, 0xcd, 0x2f, 0x17, 0xe8, 0xfc, 0x95, 0xe9,
    0x27, 0xf9, 0x59, 0xe6, 0x38, 0x96, 0x1d, 0xa3, 0x01, 0x46, 0xba, 0x74, 0xb4, 0x49, 0xfa, 0x1e,
    0x4b, 0xad, 0xb0, 0x92, 0xfa, 0x9a, 0x2b, 0xe2, 0xba, 0xea, 0xaf, 0xe7, 0x31, 0xa6, 0xfb, 0x76,
    0x3d, 0x2d, 0x17, 0xc5, 0xdd, 0xbb, 0x25, 0x40, 0x8a, 0x70, 0xb1, 0x1e, 0xdb, 0xc3, 0xcb, 0x7b,
    0x9d, 0xae, 0x37, 0x5f, 0xb2, 0xb7, 0x52, 0x81, 0xf4, 0x75, 0xf9, 0xa8, 0xee, 0x65, 0xec, 0xac,
    0x76, 0xe2, 0xf3, 0x52, 0x98, 0x6a, 0xa3, 0x69, 0xf7, 0x62, 0x9b, 0xe7, 0x95, 0x64, 0x37, 0x93,
    0xd4, 0x4f, 0x1b, 0x89, 0x03, 0xcb, 0xc5, 0x46, 0x90, 0x55, 0x55, 0x94, 0x1c, 0x27, 0xbc, 0x7c,
    0x25, 0xaa, 0x6a, 0xc7, 0x09, 0x87, 0x6a, 0xf5, 0x68, 0xb0, 0x2a, 0xbc, 0xaf, 0xfc, 0x86, 0xf5,
    0x6c, 0x8b, 0x84, 0xbe, 0xee, 0xdd, 0xe2, 0xb6, 0xcd, 0x9f, 0x60, 0x13, 0xe9, 0x56, 0xcc, 0xbf,
    0x77, 0x70, 0xd3, 0x31, 0xd9, 0x17, 0xd6, 0xf3, 0x6d, 0x1a, 0xfe, 0x9a, 0x72, 0x2f, 0x7d, 0xcb,
    0xf1, 0xfc, 0x25, 0xae, 0xce, 0x4f, 0x51, 0xdb, 0x3e, 0x95, 0xeb, 0xfe, 0xf2, 0x3c, 0x6d, 0x4c,
    0xec, 0x1d, 0xae, 0xf4, 0xe2, 0x07, 0x5c, 0x80, 0x9b, 0x36, 0xe9, 0xf9, 0xcb, 0x14, 0x26, 0x79,
    0x17, 0x91, 0x7d, 0x87, 0xdf, 0x18, 0xa5, 0xe7, 0x55, 0x14, 0x24, 0x33, 0x0f, 0x57, 0x4f, 0x54,
    0xb9, 0xeb, 0xc3, 0x1f, 0x4c, 0x4e, 0x54, 0xc8, 0xab, 0xdf, 0xbd, 0x3e, 0xb7, 0xeb, 0xdd, 0xc9,
    0xab, 0xc0, 0xe8, 0x03, 0xb9, 0x69, 0xbd, 0xfd, 0x21, 0xd1, 0x3f, 0x45, 0xf2, 0x72, 0x60, 0x1b,
    0x1d, 0x9b, 0x36, 0x4f, 0x5b, 0x99, 0xbf, 0x72, 0x05, 0xea, 0xdf, 0xb8, 0x6d, 0x9c, 0xe5, 0x62,
    0x1f, 0xf7, 0xd6, 0xa6, 0x0a, 0x06, 0x64, 0x2a, 0x3b, 0x74, 0x14, 0x8f, 0x2f, 0x65, 0x45, 0x65,
    0xe0, 0x5a, 0xb1, 0x63, 0x37, 0x9f, 0x71, 0x2a, 0x6e, 0x1b, 0x52, 0x05, 0xe5, 0xdf, 0x7f, 0x2f,
    0x17, 0xbf, 0x3f, 0x18, 0x6c, 0x29, 0xff, 0xf2, 0xe9, 0xfc, 0x07, 0x50, 0x4b, 0x01, 0x02, 0x1e,
    0x03, 0x14, 0x00, 0x00, 0x00, 0x08, 0x00, 0x33, 0x58, 0x4e, 0x56, 0x26, 0x0a, 0x1e, 0x8b, 0xd2,
    0x04, 0x00, 0x00, 0x92, 0x06, 0x00, 0x00, 0x0f, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
    0x00, 0x00, 0x00, 0xb4, 0x81, 0x00, 0x00, 0x00, 0x00, 0x67, 0x6f, 0x6f, 0x67, 0x6c, 0x65, 0x2e,
    0x63, 0x65, 0x72, 0x74, 0x2e, 0x70, 0x65, 0x6d, 0x55, 0x54, 0x05, 0x00, 0x03, 0x91, 0xf9, 0xea,
    0x63, 0x75, 0x78, 0x0b, 0x00, 0x01, 0x04, 0x02, 0x45, 0xa5, 0x36, 0x04, 0x02, 0x45, 0xa5, 0x36,
    0x50, 0x4b, 0x05, 0x06, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x55, 0x00, 0x00, 0x00,
    0x1b, 0x05, 0x00, 0x00, 0x00, 0x00,
};

static int32_t test_pal_cipher_init(void)
{
    return 0;
}

static void test_pal_cipher_cleanup(void)
{

}

static void test_pal_cipher_crc32(void)
{
    int32_t ret = 0;
    uint32_t crc = 0;

    ret = pal_crc32(test_buf1, UTILS_ARRAY_SIZE(test_buf1), &crc);
    CU_ASSERT_EQUAL(ret, 0);
    CU_ASSERT_EQUAL(crc, 0x75815883);

    ret = pal_crc32(test_buf2, UTILS_ARRAY_SIZE(test_buf2), &crc);
    CU_ASSERT_EQUAL(ret, 0);
    CU_ASSERT_EQUAL(crc, 0xe96b0b14);

    ret = pal_crc32(test_buf3, UTILS_ARRAY_SIZE(test_buf3), &crc);
    CU_ASSERT_EQUAL(ret, 0);
    CU_ASSERT_EQUAL(crc, 0x01ac9513);
}

static void test_pal_cipher_encryption_128(void)
{
#define TEST_ENCRYPT_LEN 4096
    int32_t ret = 0;
    uint8_t out_array[UTILS_ARRAY_SIZE(aes_test_cbc_enc) + 1000] = {0};
    size_t o_len = UTILS_ARRAY_SIZE(aes_test_cbc_enc) + 1000;

    ret = pal_cipher_encrypt_cbc(aes_test_cbc_enc, UTILS_ARRAY_SIZE(aes_test_cbc_enc), aes_test_cbc_key, UTILS_ARRAY_SIZE(aes_test_cbc_key), aes_test_cbc_iv, UTILS_ARRAY_SIZE(aes_test_cbc_iv), out_array, &o_len);
    CU_ASSERT_EQUAL(ret, 0);
    CU_ASSERT_EQUAL(utils_memcmp(aes_test_cbc_dec, out_array, UTILS_ARRAY_SIZE(aes_test_cbc_enc)), 0);
}

static void test_pal_cipher_decryption_128(void)
{
#define TEST_ENCRYPT_LEN 4096
    int32_t ret = 0;
    uint8_t out_array[UTILS_ARRAY_SIZE(aes_test_cbc_dec_padding) + 1000] = {0};
    size_t o_len = UTILS_ARRAY_SIZE(aes_test_cbc_dec_padding) + 1000;

    ret = pal_cipher_decrypt_cbc(aes_test_cbc_dec, UTILS_ARRAY_SIZE(aes_test_cbc_dec), aes_test_cbc_key, UTILS_ARRAY_SIZE(aes_test_cbc_key), aes_test_cbc_iv, UTILS_ARRAY_SIZE(aes_test_cbc_iv), out_array, &o_len);
    CU_ASSERT_EQUAL(ret, 0);
    CU_ASSERT_EQUAL(utils_memcmp(aes_test_cbc_enc, out_array, UTILS_ARRAY_SIZE(aes_test_cbc_enc)), 0);
}

static void test_pal_cipher_encryption_256(void)
{
#define TEST_ENCRYPT_LEN 4096
    int32_t ret = 0;
    uint8_t out_array[UTILS_ARRAY_SIZE(aes_test_cbc_enc) + 1000] = {0};
    size_t o_len = UTILS_ARRAY_SIZE(aes_test_cbc_enc) + 1000;

    ret = pal_cipher_encrypt_cbc(aes_test_cbc_enc, UTILS_ARRAY_SIZE(aes_test_cbc_enc), aes_test_cbc_key_256, UTILS_ARRAY_SIZE(aes_test_cbc_key_256), aes_test_cbc_iv, UTILS_ARRAY_SIZE(aes_test_cbc_iv), out_array, &o_len);
    CU_ASSERT_EQUAL(ret, 0);
    CU_ASSERT_EQUAL(utils_memcmp(aes_test_cbc_dec_256, out_array, UTILS_ARRAY_SIZE(aes_test_cbc_dec_256)), 0);
}

static void test_pal_cipher_decryption_256(void)
{
#define TEST_ENCRYPT_LEN 4096
    int32_t ret = 0;
    uint8_t out_array[UTILS_ARRAY_SIZE(aes_test_cbc_dec) + 1000] = {0};
    size_t o_len = UTILS_ARRAY_SIZE(aes_test_cbc_dec) + 1000;

    ret = pal_cipher_decrypt_cbc(aes_test_cbc_dec_256, UTILS_ARRAY_SIZE(aes_test_cbc_dec_256), aes_test_cbc_key_256, UTILS_ARRAY_SIZE(aes_test_cbc_key_256), aes_test_cbc_iv, UTILS_ARRAY_SIZE(aes_test_cbc_iv), out_array, &o_len);
    CU_ASSERT_EQUAL(ret, 0);
    CU_ASSERT_EQUAL(utils_memcmp(aes_test_cbc_enc, out_array, UTILS_ARRAY_SIZE(aes_test_cbc_enc)), 0);
}

static void test_pal_cipher_encryption_decryption_256_by_self(void)
{
#define TEST_ENCRYPT_LEN 4096
    int32_t ret = 0;
    uint8_t array[TEST_ENCRYPT_LEN + 1000] = {0};
    uint8_t out_array[TEST_ENCRYPT_LEN + 1000] = {0};
    uint8_t origin_array[TEST_ENCRYPT_LEN + 1000] = {0};
    uint8_t key[PAL_CIPHER_AES_CBC_256_KEY_BYTES_LEN] = {0};
    uint8_t iv[PAL_CIPHER_AES_CBC_IV_BYTES_LEN] = {0};
    size_t o_len = TEST_ENCRYPT_LEN + 1000, i = 0;

    for (i = 0; i < TEST_ENCRYPT_LEN; i ++) {
        array[i] = i;
        origin_array[i] = i;
    }

    ret = utils_convert_str_to_be(PROV_AES_COM_KEY, key, strlen(PROV_AES_COM_KEY));
    CU_ASSERT_EQUAL(ret, 0);

    ret = utils_convert_str_to_be(PROV_AES_COM_IV, iv, strlen(PROV_AES_COM_IV));
    CU_ASSERT_EQUAL(ret, 0);

    ret = pal_cipher_encrypt_cbc(array, TEST_ENCRYPT_LEN, key, UTILS_ARRAY_SIZE(key), iv, UTILS_ARRAY_SIZE(iv), out_array, &o_len);
    CU_ASSERT_EQUAL(ret, 0);

    ret = pal_cipher_decrypt_cbc(out_array, TEST_ENCRYPT_LEN, key, UTILS_ARRAY_SIZE(key), iv, UTILS_ARRAY_SIZE(iv), array, &o_len);
    CU_ASSERT_EQUAL(ret, 0);

    CU_ASSERT_EQUAL(utils_memcmp(array, origin_array, TEST_ENCRYPT_LEN), 0);
}

static void test_pal_cipher_encryption_decryption_256_unaligned(void)
{
#define TEST_ENCRYPT_LEN 4097
    int32_t ret = 0;
    uint8_t array[TEST_ENCRYPT_LEN + 1000] = {0};
    uint8_t out_array[TEST_ENCRYPT_LEN + 1000] = {0};
    uint8_t origin_array[TEST_ENCRYPT_LEN + 1000] = {0};
    uint8_t key[PAL_CIPHER_AES_CBC_256_KEY_BYTES_LEN] = {0};
    uint8_t iv[PAL_CIPHER_AES_CBC_IV_BYTES_LEN] = {0};
    size_t o_len = TEST_ENCRYPT_LEN + 1000, i = 0;

    for (i = 0; i < TEST_ENCRYPT_LEN; i ++) {
        array[i] = i;
        origin_array[i] = i;
    }

    ret = utils_convert_str_to_be(PROV_AES_COM_KEY, key, strlen(PROV_AES_COM_KEY));
    CU_ASSERT_EQUAL(ret, 0);

    ret = utils_convert_str_to_be(PROV_AES_COM_IV, iv, strlen(PROV_AES_COM_IV));
    CU_ASSERT_EQUAL(ret, 0);

    ret = pal_cipher_encrypt_cbc(array, TEST_ENCRYPT_LEN, key, UTILS_ARRAY_SIZE(key), iv, UTILS_ARRAY_SIZE(iv), out_array, &o_len);
    CU_ASSERT_EQUAL(ret, HAL_ERR_INVALID_PARAM);

    ret = pal_cipher_decrypt_cbc(out_array, TEST_ENCRYPT_LEN, key, UTILS_ARRAY_SIZE(key), iv, UTILS_ARRAY_SIZE(iv), array, &o_len);
    CU_ASSERT_EQUAL(ret, HAL_ERR_INVALID_PARAM);
}


int32_t test_pal_cipher_entry()
{
    int32_t ret = 0;
    void *rp = NULL;
    CU_pSuite p_pal_cipher = NULL;

    p_pal_cipher = CU_add_suite("PAL CIPHER", test_pal_cipher_init, test_pal_cipher_cleanup);
    UTILS_CHECK_CONDITION(NULL == p_pal_cipher, -1, "p_pal_cipher add suite failed!\n");

    rp = CU_add_test(p_pal_cipher, "test of test_pal_cipher_crc32", test_pal_cipher_crc32);
    UTILS_CHECK_CONDITION(NULL == rp, -1, "CU_add_test failed!\n");

    rp = CU_add_test(p_pal_cipher, "test of test_pal_cipher_encryption_128 bits key", test_pal_cipher_encryption_128);
    UTILS_CHECK_CONDITION(NULL == rp, -1, "CU_add_test failed!\n");

    rp = CU_add_test(p_pal_cipher, "test of test_pal_cipher_decryption_128 bits key", test_pal_cipher_decryption_128);
    UTILS_CHECK_CONDITION(NULL == rp, -1, "CU_add_test failed!\n");

    rp = CU_add_test(p_pal_cipher, "test of test_pal_cipher_encryption_256 bits key", test_pal_cipher_encryption_256);
    UTILS_CHECK_CONDITION(NULL == rp, -1, "CU_add_test failed!\n");

    rp = CU_add_test(p_pal_cipher, "test of test_pal_cipher_decryption_256 bits key", test_pal_cipher_decryption_256);
    UTILS_CHECK_CONDITION(NULL == rp, -1, "CU_add_test failed!\n");

    rp = CU_add_test(p_pal_cipher, "test of test_pal_cipher_encryption_decryption_256_by_self", test_pal_cipher_encryption_decryption_256_by_self);
    UTILS_CHECK_CONDITION(NULL == rp, -1, "CU_add_test failed!\n");

    rp = CU_add_test(p_pal_cipher, "test of test_pal_cipher_encryption_decryption_256_unaligned", test_pal_cipher_encryption_decryption_256_unaligned);
    UTILS_CHECK_CONDITION(NULL == rp, -1, "CU_add_test failed!\n");

finish:
    return ret;
}
